{"$schema":"https://www.krakend.io/schema/v3.json","async_agent":[{"backend":[{"host":["http://127.0.0.1:8080"],"method":"POST","url_pattern":"/__debug/async-agent-demo"}],"connection":{"backoff_strategy":"exponential-jitter","max_retries":10},"consumer":{"topic":"*.bar","workers":20},"extra_config":{"async/amqp":{"auto_ack":true,"exchange":"foo","host":"amqp://guest:guest@localhost:5672/","name":"krakend","prefetch_count":40}},"name":"async-agent-demo"}],"cache_ttl":"300s","debug_endpoint":true,"endpoints":[{"backend":[{"host":["http://localhost:8080"],"url_pattern":"/__debug/admin"}],"endpoint":"/api-key","extra_config":{"auth/api-keys":{"roles":["admin"]},"documentation/openapi":{"description":"This endpoint uses API-Key authentication","summary":"Some information behind API-Keys authentication protection","tags":["Authentication"]}}},{"backend":[{"@comment":"We will route to the backend using the content of the 'X-Route' header","@test_with":"curl -iG -H 'X-Route: hello' 'http://localhost:8080/dynamic/header'","host":["http://localhost:8080"],"url_pattern":"/__debug/{input_headers.x-route}"}],"endpoint":"/dynamic/header"},{"backend":[{"@comment":"We will route to the backend using the content of the 'X-Route' header","@test_with":"curl -iG 'http://localhost:8080/dynamic/qs?route=hello'","host":["http://localhost:8080"],"url_pattern":"/__debug/{input_query_strings.route}"}],"endpoint":"/dynamic/qs"},{"backend":[{"extra_config":{"backend/grpc":{"input_mapping":{"lat":"where.latitude","lon":"where.longitude"}}},"group":"flights","host":["localhost:4242"],"url_pattern":"/flight_finder.Flights/FindFlight"},{"extra_config":{"backend/grpc":{"client_tls":{"allow_insecure_connections":true},"input_mapping":{"lat":"origin.position.latitude","lon":"origin.position.longitude"},"output_duration_as_string":true,"output_enum_as_string":true,"output_timestamp_as_string":true,"response_naming_convention":"camelCase"}},"group":"trains","host":["localhost:4243"],"url_pattern":"/train_finder.Trains/FindTrains"},{"group":"hotels","url_pattern":"/hotels/1.json"},{"extra_config":{"backend/grpc":{"client_tls":{"allow_insecure_connections":true},"output_remove_unset_values":true,"response_naming_convention":"camelCase"}},"group":"trains_classes","host":["localhost:4243"],"url_pattern":"/train_finder.Trains/GetTrainClasses"}],"endpoint":"/travel","input_query_strings":["lat","lon"]},{"backend":[{}],"endpoint":"/travel_book_flight","method":"POST"},{"backend":[{"url_pattern":"/"}],"endpoint":"/fake-api/*","extra_config":{"documentation/openapi":{"description":"This endpoint will send all requests to a designed backend including everything after the /fake-api path\n","summary":"Calls to internal service with wildcard","tags":["Wildcard"]}}},{"backend":[{"disable_host_sanitize":true,"host":["ws://localhost:4245"],"url_pattern":"/ws/{room}"}],"endpoint":"/chat/ws/{room}","extra_config":{"websocket":{"backoff_strategy":"exponential","connect_event":true,"disconnect_event":true,"input_headers":["Cookie","Authorization"],"max_message_size":3200000,"max_retries":0,"message_buffer_size":4096,"ping_period":"54s","pong_wait":"60s","read_buffer_size":4096,"write_buffer_size":4096,"write_wait":"10s"}},"input_headers":["*"],"input_query_strings":["*"]},{"backend":[{"encoding":"no-op","host":["http://localhost:4245"],"url_pattern":"/"}]},{"backend":[{"encoding":"no-op","host":["http://chat:8888"],"url_pattern":"/"}],"endpoint":"/chat","output_encoding":"no-op"},{"backend":[{"url_pattern":"/"}],"endpoint":"/fake-api-geofence/*","extra_config":{"documentation/openapi":{"description":"This endpoint will send all requests to a designed backend \nincluding everything after the /fake-api-geofence path, adding \ngeofencing (allowing calls only from Spain)\n","summary":"Calls to internal service with wildcard, using geofencing,","tags":["Wildcard"]},"validation/cel":[{"check_expr":"req_headers['X-Geoip'][0].matches('\"IsoCode\":\"ES\"')"}]},"input_headers":["X-Geoip"]},{"backend":[{"allow":["avatar_url","name","company","blog","location","mail","hireable","followers","public_repos","public_gists"],"group":"user","host":["https://api.github.com"],"mapping":{"blog":"website"},"url_pattern":"/users/{user}"},{"host":["https://api.github.com"],"is_collection":true,"mapping":{"collection":"repos"},"url_pattern":"/users/{user}/repos"}],"endpoint":"/git/{user}","extra_config":{"documentation/openapi":{"description":"This endpoint fetches in parallel the user information and the \nrepository information from Githuib and returns it together. \nNon interesting fields are removed\n","summary":"Merges two calls from github and serves under a single endpoint","tags":["Aggregation"]}}},{"backend":[{"url_pattern":"/user/1.json"}],"endpoint":"/private/auth0","extra_config":{"auth/validator":{"alg":"RS256","audience":["http://api.example.com"],"jwk_url":"https://albert-test.auth0.com/.well-known/jwks.json","roles":["user","admin"],"roles_key":"http://api.example.com/custom/roles"},"documentation/openapi":{"description":"This endpoint uses JWT authentication with Auth0","summary":"Some information behind JWT authentication protection (Auth0)","tags":["Authentication"]}}},{"backend":[{"encoding":"safejson","extra_config":{"qos/http-cache":{"shared":true}},"host":["https://api.coingecko.com"],"mapping":{"collection":"coins"},"url_pattern":"/api/v3/coins/markets?vs_currency=eur\u0026ids=bitcoin%2Cethereum\u0026order=market_cap_desc\u0026per_page=100\u0026page=1\u0026sparkline=false"}],"endpoint":"/market/cached"},{"backend":[{"url_pattern":"/hotels/1.json"}],"endpoint":"/public"},{"backend":[{"encoding":"safejson","extra_config":{"qos/http-cache":{"shared":true}},"host":["https://api.coingecko.com"],"mapping":{"collection":"coins"},"url_pattern":"/api/v3/coins/markets?vs_currency=eur\u0026ids=bitcoin%2Cethereum\u0026order=market_cap_desc\u0026per_page=100\u0026page=1\u0026sparkline=false"}],"concurrent_calls":3,"endpoint":"/market/concurrent","extra_config":{"documentation/openapi":{"description":"This endpoint fetches crypto market information from Coingecko using 3 concurrent calls\n","summary":"Get crypto market information with 3 concurrent calls","tags":["Concurrent calls"]}}},{"backend":[{"encoding":"safejson","host":["https://api.coingecko.com"],"mapping":{"collection":"coins"},"url_pattern":"/api/v3/coins/markets?vs_currency=eur\u0026ids=bitcoin%2Cethereum\u0026order=market_cap_desc\u0026per_page=100\u0026page=1\u0026sparkline=false"}],"endpoint":"/market/simple","extra_config":{"documentation/openapi":{"description":"This endpoint fetches crypto market information from Coingecko\nusing a single non-concurrent call\n","summary":"Get crypto market information with a single call","tags":["Concurrent calls"]}}},{"backend":[{"deny":["-m"],"encoding":"xml","extra_config":{"backend/soap":{"@comment":"The XML template with variables is in the following path:","path":"./templates/soap_request_capital_city.tmpl.xml"}},"host":["http://webservices.oorsprong.org"],"mapping":{"CapitalCityResult":"capital"},"method":"POST","target":"Envelope.Body.CapitalCityResponse","url_pattern":"/websamples.countryinfo/CountryInfoService.wso"}],"endpoint":"/capital-of/{country}"},{"backend":[{"encoding":"safejson","host":["https://api.coingecko.com"],"url_pattern":"/api/v3/coins/markets?vs_currency={currency}\u0026order=market_cap_desc\u0026per_page=100\u0026page=1\u0026sparkline=false"}],"endpoint":"/cryptos/{currency}","extra_config":{"documentation/openapi":{"description":"This endpoint fetches some crypto capitalization data from Coingecko for a given currency\n","summary":"Get TOP 5 crypto capitalization \u0026 price data for a given currency","tags":["Aggregation"]},"modifier/jmespath":{"expr":"reverse(sort_by(collection[:5], \u0026name))[*].{name: name, token: symbol,price: current_price, price_change: price_change_percentage_24h, market_cap: market_cap}"}},"output_encoding":"json-collection"},{"backend":[{"url_pattern":"/token.json"}],"endpoint":"/token","extra_config":{"auth/signer":{"alg":"HS256","disable_jwk_security":true,"jwk_url":"http://localhost:8000/jwk/symmetric.json","keys_to_sign":["access_token","refresh_token"],"kid":"sim2"}}},{"backend":[{"host":["http://unexistent_backend"],"url_pattern":"/"}],"endpoint":"/mocked-response","extra_config":{"proxy":{"static":{"data":{"an_array":["arr1","arr2"],"an_integer":123,"an_object":{"obj":"obj1"}},"strategy":"always"}}},"method":"GET","output_encoding":"json"},{"backend":[{"url_pattern":"/__debug/post"}],"endpoint":"/post","method":"POST"},{"backend":[{"allow":["campaigns"],"url_pattern":"/shop/campaigns.json"},{"allow":["products"],"extra_config":{"qos/ratelimit/proxy":{"capacity":1,"max_rate":1}},"url_pattern":"/shop/products.json"}],"endpoint":"/shop","extra_config":{"qos/ratelimit/router":{"max_rate":2}}},{"backend":[{"allow":["credit_card"],"extra_config":{"plugin/req-resp-modifier":{"content-replacer":{"credit_card.number":{"@comment":"Ridiculous card masking. Show last 4 digits and remove the rest. Credit card number is nested.","find":"^.*(\\d{4})","regexp":true,"replace":"XXXX-${1}"}},"name":["content-replacer"]}},"url_pattern":"/user/1.json"}],"endpoint":"/user/creditcard"},{"backend":[{"host":["http://localhost:8080"],"url_pattern":"/__debug/cookie"}],"endpoint":"/track-user","extra_config":{"security/policies":{"req":{"error":{"body":"User did not accept the cookie and tracking is not allowed","status":403},"policies":["getCookie('GDPR') == 'yes'"]}}},"input_headers":["Cookie"]},{"backend":[{"allow":["destination_id"],"url_pattern":"/hotels/1.json"},{"url_pattern":"/destinations/{resp0_destination_id}.json"}],"endpoint":"/sequential","extra_config":{"proxy":{"sequential":true}}}],"extra_config":{"auth/api-keys":{"keys":[{"@description":"ACME Inc.","key":"4d2c61e1-34c4-e96c-9456-15bd983c5019","roles":["role1","role2"]},{"@description":"Administrators Inc.","key":"58427514-be32-0b52-b7c6-d01fada30497","roles":["admin","user"]}]},"auth/basic":{"@comment":"Location of the password file for endpoints requiring basic auth","htpasswd_path":".//.htpasswd"},"auth/revoker":{"N":10000000,"P":1e-7,"TTL":1500,"hash_name":"optimal","port":1234,"token_keys":["jti"]},"documentation/openapi":{"contact_email":"contact@example.com","contact_name":"John Doe","license_name":"MIT","license_url":"https://opensource.org/licenses/MIT","version":"1"},"grpc":{"catalog":["../../images/grpc/defs"]},"plugin/http-server":{"geoip":{"citydb_path":".//geoip/GeoLite2-City.mmdb"},"name":["static-filesystem","geoip","url-rewrite"],"static-filesystem":{"path":".//demo/","prefix":"/demo/"},"url-rewrite":{"literal":{"/git-profile":"/git"},"regexp":[["/git-profile/([a-z]{3})","/git/${1}"],["/crypto-profile/([a-z]{3})","/cryptos/${1}"]]}},"router":{"return_error_msg":true},"security/cors":{"allow_headers":["Origin","Authorization","Content-Type"],"allow_methods":["POST","GET"],"allow_origins":["*"],"expose_headers":["Content-Length"],"max_age":"12h"},"telemetry/gelf":{"address":"localhost:12201","enable_tcp":false},"telemetry/influx":{"address":"http://localhost:8086","buffer_size":100,"password":"pas5w0rd","ttl":"25s","username":"krakend-dev"},"telemetry/logging":{"level":"DEBUG","prefix":"[KRAKEND]","stdout":true,"syslog":false},"telemetry/metrics":{"collection_time":"30s","listen_address":":8090"},"telemetry/opencensus":{"enabled_layers":{"backend":true,"router":true},"exporters":{"jaeger":{"endpoint":"http://jaeger:14268/api/traces","service_name":"krakend"}},"reporting_period":1,"sample_rate":100}},"host":["http://fake_api:8080"],"name":"KrakenD Enterprise API Gateway","plugin":{"folder":"/opt/krakend/plugins/","pattern":".so"},"port":8080,"sequential_start":true,"timeout":"3000ms","version":3}