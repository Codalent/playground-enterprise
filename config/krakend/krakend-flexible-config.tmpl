{
    "$schema": "https://www.krakend.io/schema/v3.json",
    "version": 3,
    "name": "Sample Gateway",
    "port": {{ .env.port }},
    "timeout": "30s",
    "cache_ttl": "300s",
    "extra_config": {{ include "extra_config.tmpl" }},
    "endpoints": [
      {{ template "sample_template.tmpl" . }},

      {{ range $idx, $endpoint := .loop_example.dummy }}
        {{ if $idx }},{{ end }}
        {
            "endpoint": "{{ $endpoint }}",
            "backend": [
              {
                "host": [ "http://localhost:8080" ],
                "url_pattern": "/__debug{{ $endpoint }}"
              }
            ]
        }
      {{ end }}

      {{ $supu := . }}
      {{ range $tidx, $team := .enabled_teams }}
      ,
      {{ $path_prefix := index $supu $team "path_prefix" }}
      {{ range $idx, $team_ep := index $supu $team "endpoints" }}
      {{ if $idx }},{{ end }}
        {
            "endpoint": "{{ $path_prefix }}{{ index $team_ep "path" }}",
            "method": "{{ index $team_ep "method" }}",
            "backend": [
              {
                "host": [ "http://localhost:8080" ],
                "url_pattern": "/__debug{{ $path_prefix }}{{ index $team_ep "path" }}"
              }
            ]
        }
      {{ end }}
      {{ end }}

   ]
}
